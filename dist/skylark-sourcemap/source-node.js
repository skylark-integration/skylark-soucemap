/**
 * skylark-sourcemap - A version of sourcemap that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./source-map-generator","./util"],function(n,e){"use strict";e=__module__1;var t=/(\r?\n)/,r="$$$isSourceNode$$$";function o(n,e,t,o,i){this.children=[],this.sourceContents={},this.line=null==n?null:n,this.column=null==e?null:e,this.source=null==t?null:t,this.name=null==i?null:i,this[r]=!0,null!=o&&this.add(o)}return o.fromStringWithSourceMap=function(n,r,i){var l=new o,u=n.split(t),s=0,c=function(){return n()+(n()||"");function n(){return s<u.length?u[s++]:void 0}},a=1,h=0,d=null;return r.eachMapping(function(n){if(null!==d){if(!(a<n.generatedLine)){var e=(t=u[s]||"").substr(0,n.generatedColumn-h);return u[s]=t.substr(n.generatedColumn-h),h=n.generatedColumn,p(d,e),void(d=n)}p(d,c()),a++,h=0}for(;a<n.generatedLine;)l.add(c()),a++;if(h<n.generatedColumn){var t=u[s]||"";l.add(t.substr(0,n.generatedColumn)),u[s]=t.substr(n.generatedColumn),h=n.generatedColumn}d=n},this),s<u.length&&(d&&p(d,c()),l.add(u.splice(s).join(""))),r.sources.forEach(function(n){var t=r.sourceContentFor(n);null!=t&&(null!=i&&(n=e.join(i,n)),l.setSourceContent(n,t))}),l;function p(n,t){if(null===n||void 0===n.source)l.add(t);else{var r=i?e.join(i,n.source):n.source;l.add(new o(n.originalLine,n.originalColumn,r,t,n.name))}}},o.prototype.add=function(n){if(Array.isArray(n))n.forEach(function(n){this.add(n)},this);else{if(!n[r]&&"string"!=typeof n)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+n);n&&this.children.push(n)}return this},o.prototype.prepend=function(n){if(Array.isArray(n))for(var e=n.length-1;e>=0;e--)this.prepend(n[e]);else{if(!n[r]&&"string"!=typeof n)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+n);this.children.unshift(n)}return this},o.prototype.walk=function(n){for(var e,t=0,o=this.children.length;t<o;t++)(e=this.children[t])[r]?e.walk(n):""!==e&&n(e,{source:this.source,line:this.line,column:this.column,name:this.name})},o.prototype.join=function(n){var e,t,r=this.children.length;if(r>0){for(e=[],t=0;t<r-1;t++)e.push(this.children[t]),e.push(n);e.push(this.children[t]),this.children=e}return this},o.prototype.replaceRight=function(n,e){var t=this.children[this.children.length-1];return t[r]?t.replaceRight(n,e):"string"==typeof t?this.children[this.children.length-1]=t.replace(n,e):this.children.push("".replace(n,e)),this},o.prototype.setSourceContent=function(n,t){this.sourceContents[e.toSetString(n)]=t},o.prototype.walkSourceContents=function(n){for(var t=0,o=this.children.length;t<o;t++)this.children[t][r]&&this.children[t].walkSourceContents(n);var i=Object.keys(this.sourceContents);for(t=0,o=i.length;t<o;t++)n(e.fromSetString(i[t]),this.sourceContents[i[t]])},o.prototype.toString=function(){var n="";return this.walk(function(e){n+=e}),n},o.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new n(e),o=!1,i=null,l=null,u=null,s=null;return this.walk(function(n,e){t.code+=n,null!==e.source&&null!==e.line&&null!==e.column?(i===e.source&&l===e.line&&u===e.column&&s===e.name||r.addMapping({source:e.source,original:{line:e.line,column:e.column},generated:{line:t.line,column:t.column},name:e.name}),i=e.source,l=e.line,u=e.column,s=e.name,o=!0):o&&(r.addMapping({generated:{line:t.line,column:t.column}}),i=null,o=!1);for(var c=0,a=n.length;c<a;c++)10===n.charCodeAt(c)?(t.line++,t.column=0,c+1===a?(i=null,o=!1):o&&r.addMapping({source:e.source,original:{line:e.line,column:e.column},generated:{line:t.line,column:t.column},name:e.name})):t.column++}),this.walkSourceContents(function(n,e){r.setSourceContent(n,e)}),{code:t.code,map:r}},o});
//# sourceMappingURL=sourcemaps/source-node.js.map
